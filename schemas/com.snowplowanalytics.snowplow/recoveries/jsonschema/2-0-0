{
  "$schema": "http://iglucentral.com/schemas/com.snowplowanalytics.self-desc/schema/jsonschema/1-0-0#",
  "description": "Schema for an array of recovery scenarios",
  "self": {
    "vendor": "com.snowplowanalytics.snowplow",
    "name": "recoveries",
    "format": "jsonschema",
    "version": "2-0-0"
  },
  "type": "object",
  "propertyNames": {
    "pattern": "^iglu:.+"
  },
  "minProperties": 1,
  "patternProperties": {
    "^iglu:": {
      "$ref": "#/definitions/flow"
    }
  },
  "definitions": {
    "flow": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^(([a-zA-Z0-9]+)(-?))+$",
            "minLength": 1,
            "description": "A slug name for recovery flow"
          },
          "conditions": {
            "type": "array",
            "items": {
              "$ref": "#/definitions/op"
            },
            "description": "Conditions required to apply steps for specific Bad Row type"
          },
          "steps": {
            "type": "array",
            "minItems": 1,
            "items": {
              "$ref": "#/definitions/op"
            },
            "description": "Steps to be applied for specific Bad Row type"
          }
        },
        "required": [
          "name",
          "conditions",
          "steps"
        ],
        "additionalProperties": {
          "type": "array"
        }
      }
    },
    "op": {
      "type": "object",
      "properties": {
        "op": {
          "type": "string",
          "enum": [
            "Cast",
            "Remove",
            "Replace",
            "Test"
          ],
          "description": ""
        },
        "path": {
          "type": "string",
          "pattern": "^(([a-zA-Z0-9]+)(\\.?))+$",
          "description": ""
        },
        "match": {
          "type": "string",
          "description": ""
        },
        "value": {
          "type": "string",
          "description": ""
        },
        "from": {
          "type": "string",
          "description": ""
        },
        "to": {
          "type": "string",
          "description": ""
        }
      },
      "required": [
        "op",
        "path",
        "value"
      ],
      "additionalProperties": false
    }
  }
}
